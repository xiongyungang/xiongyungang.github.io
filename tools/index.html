<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tools</title>

<style>
/* ===== 页面整体 ===== */
body{
  margin:0;
  padding:40px 0;
  background:#f3f4f6;
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial;
  color:#111;
}

/* 类似 Word 文档的居中页面 */
.main{
  max-width: 900px;
  margin: 0 auto;
  background:#fff;
  padding: 36px 48px;
  border-radius: 8px;
  box-shadow: 0 10px 30px rgba(0,0,0,.08);
}

/* 标题 */
h1{
  margin:0 0 24px 0;
  font-size: 22px;
  border-bottom: 1px solid #e5e7eb;
  padding-bottom: 12px;
}

/* 控件 */
.controls{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:16px;
}
input[type="search"]{
  padding:8px 10px;
  border:1px solid #d1d5db;
  border-radius:6px;
  min-width:260px;
}
button{
  padding:8px 14px;
  border-radius:6px;
  border:1px solid #d1d5db;
  background:#fff;
  cursor:pointer;
}
button:hover{
  background:#f9fafb;
}
#status{
  width:100%;
  margin-top:6px;
  font-size:13px;
  color:#6b7280;
}

/* 列表 */
ul{
  list-style:none;
  padding:0;
  margin:24px 0 0 0;
}
li{
  padding:12px 4px;
  border-bottom:1px solid #f1f5f9;
}
li:last-child{
  border-bottom:none;
}
a{
  color:#2563eb;
  text-decoration:none;
  font-size:16px;
}
a:hover{
  text-decoration:underline;
}

/* 页脚 */
.footer{
  margin-top:32px;
  font-size:13px;
  color:#9ca3af;
}
</style>
</head>

<body>
<div class="main">

<h1>/tools</h1>

<div class="controls">
  <input id="q" type="search" placeholder="筛选目录名称…" />
  <button id="refresh">刷新</button>
  <div id="status"></div>
</div>

<ul id="list"></ul>

<div class="footer">
  GitHub Pages · 自动读取 /tools 下的目录
</div>

</div>

<script>
(function () {

  const OWNER = 'xiongyungang';
  const REPO  = 'xiongyungang.github.io';
  const TOOLS_PATH = 'tools';

  const listEl   = document.getElementById('list');
  const statusEl = document.getElementById('status');
  const qInput   = document.getElementById('q');
  const refreshBtn = document.getElementById('refresh');

  function setStatus(msg){
    statusEl.textContent = msg || '';
  }

  async function getDefaultBranch(){
    const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}`);
    if(!res.ok) throw new Error('无法获取仓库信息');
    const json = await res.json();
    return json.default_branch || 'main';
  }

  async function listDirs(branch){
    const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${TOOLS_PATH}?ref=${branch}`;
    const res = await fetch(url);
    if(!res.ok) throw new Error('无法读取 /tools 目录');
    const items = await res.json();

    // ★ 核心：只保留目录
    return items.filter(it => it.type === 'dir');
  }

  function render(dirs){
    listEl.innerHTML = '';
    dirs.forEach(dir => {
      const li = document.createElement('li');
      const a  = document.createElement('a');
      a.textContent = dir.name;
      a.href = `/${TOOLS_PATH}/${encodeURIComponent(dir.name)}/`;
      li.appendChild(a);
      listEl.appendChild(li);
    });
  }

  function applyFilter(){
    const q = qInput.value.trim().toLowerCase();
    for(const li of listEl.children){
      const name = li.textContent.toLowerCase();
      li.style.display = (!q || name.includes(q)) ? '' : 'none';
    }
  }

  async function refresh(){
    try{
      setStatus('正在加载…');
      const branch = await getDefaultBranch();
      const dirs = await listDirs(branch);
      render(dirs);
      setStatus(`共 ${dirs.length} 个目录 · ${new Date().toLocaleString()}`);
    }catch(err){
      console.error(err);
      setStatus('错误：' + err.message);
      listEl.innerHTML = '';
    }
  }

  qInput.addEventListener('input', applyFilter);
  refreshBtn.addEventListener('click', refresh);

  refresh();
})();
</script>

</body>
</html>
