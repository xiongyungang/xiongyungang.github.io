<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JSON æ ¼å¼åŒ–å·¥å…·</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f6f9;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .container {
      display: flex;
      gap: 20px;
      height: 70vh;
    }
    .panel {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    label {
      font-weight: bold;
      margin-bottom: 8px;
      color: #444;
    }
    textarea {
      flex: 1;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      resize: none;
      background-color: #fff;
      box-shadow: inset 0 1px 4px rgba(0,0,0,0.1);
    }
    .controls {
      margin-top: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 16px;
      background-color: #007cba;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #005a87;
    }
    button#copyBtn {
      background-color: #28a745;
    }
    button#copyBtn:hover {
      background-color: #208637;
    }
    .status {
      margin-top: 10px;
      font-size: 14px;
      color: #d9534f;
      min-height: 20px;
    }
  </style>
</head>
<body>

  <h1>ğŸ”§ JSON æ ¼å¼åŒ–å·¥å…·</h1>

  <div class="container">
    <!-- å·¦ä¾§é¢æ¿ -->
    <div class="panel">
      <label for="inputJson">åŸå§‹ JSON / è½¬ä¹‰å­—ç¬¦ä¸²ï¼š</label>
      <textarea id="inputJson" placeholder="åœ¨æ­¤ç²˜è´´æˆ–è¾“å…¥éœ€è¦å¤„ç†çš„ JSON æ•°æ®ï¼ˆæ”¯æŒå¸¦è½¬ä¹‰ç¬¦çš„å­—ç¬¦ä¸²ï¼‰"></textarea>
      <div class="controls">
        <button onclick="removeEscape()">å»é™¤è½¬ä¹‰ç¬¦</button>
        <button onclick="minifyJson()">å‹ç¼© JSON</button>
        <button onclick="formatJson()">æ ¼å¼åŒ– JSON</button>
        <button onclick="clearAll()">æ¸…ç©º</button>
      </div>
      <div id="statusLeft" class="status"></div>
    </div>

    <!-- å³ä¾§é¢æ¿ -->
    <div class="panel">
      <label for="outputJson">æ ¼å¼åŒ–ç»“æœï¼š</label>
      <textarea id="outputJson" readonly placeholder="æ ¼å¼åŒ–åçš„ JSON å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
      <div class="controls">
        <button id="copyBtn" onclick="copyResult()">ğŸ“‹ ä¸€é”®å¤åˆ¶</button>
      </div>
      <div id="statusRight" class="status"></div>
    </div>
  </div>

  <script>
    // å®æ—¶æ ¼å¼åŒ–ï¼ˆå¯é€‰ï¼šæ³¨é‡Šæ‰ä¸‹é¢å‡½æ•°ä»¥å…³é—­å®æ—¶ï¼‰
    document.getElementById('inputJson').addEventListener('input', formatJson);

    function formatJson() {
      const input = document.getElementById('inputJson').value.trim();
      const statusEl = document.getElementById('statusLeft');
      const outputEl = document.getElementById('outputJson');
      statusEl.textContent = '';
      
      if (!input) {
        outputEl.value = '';
        return;
      }

      try {
        // å°è¯•ç›´æ¥è§£æåŸå§‹è¾“å…¥
        let data = JSON.parse(input);
        outputEl.value = JSON.stringify(data, null, 2);
      } catch (e1) {
        try {
          // å¦‚æœå¤±è´¥ï¼Œå°è¯•å½“ä½œå­—ç¬¦ä¸²å»æ‰å¤–å±‚å¼•å·å¹¶è§£ç è½¬ä¹‰
          let cleaned = input;
          if (cleaned.startsWith('"') && cleaned.endsWith('"')) {
            cleaned = cleaned.slice(1, -1);
          }
          // æ›¿æ¢å¸¸è§çš„è½¬ä¹‰ç¬¦
          cleaned = cleaned
            .replace(/\\"/g, '"')
            .replace(/\\\\/g, '\\')
            .replace(/\\n/g, '\n')
            .replace(/\\r/g, '\r')
            .replace(/\\t/g, '\t')
            .replace(/\\b/g, '\b')
            .replace(/\\f/g, '\f')
            // æ³¨æ„ï¼šä¸èƒ½ç›²ç›® replace \/ -> /
            ;

          // å†æ¬¡å°è¯•è§£æ
          let data = JSON.parse(cleaned);
          outputEl.value = JSON.stringify(data, null, 2);
        } catch (e2) {
          outputEl.value = '';
          statusEl.textContent = 'âŒ JSON è§£æé”™è¯¯ï¼š' + e2.message;
        }
      }
    }

    // å»é™¤è½¬ä¹‰ç¬¦ï¼ˆæŠŠå¸¦åŒå¼•å·åŒ…è£¹çš„è½¬ä¹‰å­—ç¬¦ä¸²å˜æˆåŸå§‹ JSONï¼‰
    function removeEscape() {
      const input = document.getElementById('inputJson').value.trim();
      if (!input) return;

      let result = input;
      try {
        // å…ˆå°è¯•ä½œä¸ºå­—ç¬¦ä¸²å»è½¬ä¹‰
        if (result.startsWith('"') && result.endsWith('"')) {
          result = result.slice(1, -1);
        }
        result = result
          .replace(/\\"/g, '"')
          .replace(/\\\\/g, '\\')
          .replace(/\\n/g, '\n')
          .replace(/\\r/g, '\r')
          .replace(/\\t/g, '\t')
          .replace(/\\b/g, '\b')
          .replace(/\\f/g, '\f');

        document.getElementById('inputJson').value = result;
        formatJson(); // è‡ªåŠ¨æ ¼å¼åŒ–
      } catch (e) {
        document.getElementById('statusLeft').textContent = 'âŒ è½¬ä¹‰å¤„ç†å¤±è´¥ï¼š' + e.message;
      }
    }

    // å‹ç¼© JSONï¼ˆæ ¼å¼åŒ–åå†å‹ç¼©æˆä¸€è¡Œï¼‰
    function minifyJson() {
      const input = document.getElementById('inputJson').value.trim();
      const outputEl = document.getElementById('outputJson');
      const statusEl = document.getElementById('statusLeft');
      statusEl.textContent = '';

      if (!input) {
        outputEl.value = '';
        return;
      }

      try {
        let data = JSON.parse(input);
        outputEl.value = JSON.stringify(data); // å‹ç¼©æ— ç©ºæ ¼
      } catch (e1) {
        try {
          let cleaned = input;
          if (cleaned.startsWith('"') && cleaned.endsWith('"')) {
            cleaned = cleaned.slice(1, -1);
          }
          cleaned = cleaned
            .replace(/\\"/g, '"')
            .replace(/\\\\/g, '\\')
            .replace(/\\n/g, '\n')
            .replace(/\\r/g, '\r')
            .replace(/\\t/g, '\t');

          let data = JSON.parse(cleaned);
          outputEl.value = JSON.stringify(data);
        } catch (e2) {
          outputEl.value = '';
          statusEl.textContent = 'âŒ å‹ç¼©å¤±è´¥ï¼šæ— æ³•è§£æ JSON';
        }
      }
    }

    // ä¸€é”®å¤åˆ¶
    function copyResult() {
      const output = document.getElementById('outputJson');
      if (!output.value) {
        alert('æ²¡æœ‰å†…å®¹å¯å¤åˆ¶ï¼');
        return;
      }
      output.select();
      document.execCommand('copy');
      document.getElementById('statusRight').textContent = 'âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼';
      setTimeout(() => {
        document.getElementById('statusRight').textContent = '';
      }, 2000);
    }

    // æ¸…ç©ºæ‰€æœ‰
    function clearAll() {
      document.getElementById('inputJson').value = '';
      document.getElementById('outputJson').value = '';
      document.getElementById('statusLeft').textContent = '';
      document.getElementById('statusRight').textContent = '';
    }
  </script>

</body>
</html>
